/*!
 *
 * Bancha Scaffolding Library
 * Copyright 2011-2014 codeQ e.U.
 *
 * Licensed under The MIT License
 * Redistributions of files must retain the above copyright notice.
 *
 * @package       Bancha.scaffold
 * @copyright     Copyright 2011-2014 codeQ e.U.
 * @link          http://scaffold.bancha.io
 * @since         Bancha Scaffold v 0.3.0
 * @license       MIT License (http://www.opensource.org/licenses/mit-license.php)
 * @author        Roland Schuetz <mail@rolandschuetz.at>
 * @version       Bancha Scaffold v 2.0.2
 *
 * For more information go to http://scaffold.bancha.io
 */
if(Ext.versions.extjs.major===5){Ext.define("Ext.data.validations",{})}Ext.define("Bancha.scaffold.data.override.Validations",{requires:["Ext.data.validations"],alternateClassName:["Bancha.data.override.Validations"]},function(){var a=function(c,e){if(!c){return true}if(!Ext.isDefined(e)){return true}var d=c.split(".").pop();return Ext.Array.contains(e,d)};var b=function(c){if(Ext.Logger&&Ext.Logger.deprecate!==Ext.emptyFn){Ext.Logger.deprecate(c)}else{if(Bancha.Logger){Bancha.Logger.warn("[DEPRECATE]"+c)}else{if(Ext.global.console&&Ext.global.console.warn){Ext.global.console.warn("[DEPRECATE]"+c)}}}};Ext.apply(Ext.data.validations,{numberformatMessage:"is not a number or not in the allowed range",rangeMessage:"is not a number or not in the allowed range",fileMessage:"is not a valid file",numberformat:function(c,d){b('Bancha: Validation rules "numberformat" is deprecated in favor of "range" for Ext JS 5 compatibility.');if(typeof d!=="number"){d=(c.precision===0)?parseInt(d,10):parseFloat(d);if(typeof d!=="number"){return false}}if((Ext.isDefined(c.min)&&c.min>d)||(Ext.isDefined(c.max)&&d>c.max)){return false}return true},range:function(c,d){if(typeof d!=="number"){d=(c.precision===0)?parseInt(d,10):parseFloat(d);if(typeof d!=="number"){return false}}if((Ext.isDefined(c.min)&&c.min>d)||(Ext.isDefined(c.max)&&d>c.max)){return false}return true},file:function(c,d){return a(d,c.extension)}})});
/*!
 *
 * Bancha Scaffolding Library
 * Copyright 2011-2014 codeQ e.U.
 *
 * Licensed under The MIT License
 * Redistributions of files must retain the above copyright notice.
 *
 * @package       Bancha.scaffold
 * @copyright     Copyright 2011-2014 codeQ e.U.
 * @link          http://scaffold.bancha.io
 * @since         Bancha Scaffold v 0.3.0
 * @license       MIT License (http://www.opensource.org/licenses/mit-license.php)
 * @author        Roland Schuetz <mail@rolandschuetz.at>
 * @version       Bancha Scaffold v 2.0.2
 *
 * For more information go to http://scaffold.bancha.io
 */
if(Ext.versions.extjs.major===4){Ext.define("Ext.data.validator.Validator",{})}Ext.define("Bancha.scaffold.data.validator.File",{extend:"Ext.data.validator.Validator",alias:"data.validator.file",alternateClassName:["Bancha.data.validator.File"],type:"file",config:{message:"is not a valid file",extensions:[],extension:false},validate:function(b,a){var d=this.getExtension()||this.getExtensions();if(!b){return true}if(!Ext.isDefined(d)){return true}var c=b.split(".").pop();return Ext.Array.contains(d,c)||this.getMessage()}});
/*!
 *
 * Bancha Scaffolding Library
 * Copyright 2011-2014 codeQ e.U.
 *
 * Licensed under The MIT License
 * Redistributions of files must retain the above copyright notice.
 *
 * @package       Bancha.scaffold
 * @copyright     Copyright 2011-2014 codeQ e.U.
 * @link          http://scaffold.bancha.io
 * @since         Bancha Scaffold v 0.3.0
 * @license       MIT License (http://www.opensource.org/licenses/mit-license.php)
 * @author        Roland Schuetz <mail@rolandschuetz.at>
 * @version       Bancha Scaffold v 2.0.2
 *
 * For more information go to http://scaffold.bancha.io
 */
Ext.define("Bancha.scaffold.data.Validators",{alternateClassName:["Bancha.data.Validators"]},function(){if(Ext.versions.extjs&&Ext.versions.extjs.major===5){Ext.syncRequire("Bancha.scaffold.data.validator.File");Ext.define("Bancha.data.validator.override.Bound",{override:"Ext.data.validator.Bound",config:{nanMessage:"Must be a number"},validate:function(a){if(isNaN(this.getValue(a))){return this._nanMessage}return this.callParent(arguments)},getValue:function(a){return parseFloat(a)}});Ext.define("Ext.data.validator.override.Range",{override:"Ext.data.validator.Range"},function(){this.prototype.setNanMessage("Must be a number")})}else{Ext.syncRequire("Bancha.scaffold.data.override.Validations")}});Ext.define("Bancha.scaffold.form.field.override.VTypes",{requires:["Ext.form.field.VTypes"]},function(){var a=function(b,d){if(!b){return true}if(!Ext.isDefined(d)){return true}var c=b.split(".").pop();return Ext.Array.contains(d,c)};Ext.apply(Ext.form.field.VTypes,{fileExtension:function(c,b){return a(c,b.validExtensions)},fileExtensionText:"This file type is not allowed.",fileExtensionMask:/[\^\r\n]/})});Ext.define("Bancha.scaffold.form.Config",{uses:["Ext.window.MessageBox"],constructor:function(b){b=b||{};var d=b.triggeredFrom||"Unknown Origin",c=this,a;if(Ext.isString(b)||Bancha.scaffold.Util.isModel(b)){b={target:b}}a=b.target;a=Ext.isString(a)?a:Ext.ClassManager.getName(a);Ext.syncRequire(a);b.target=Bancha.scaffold.Util.getModel(a);if(Ext.isDefined(b.exclude)&&!Ext.isArray(b.exclude)){b.exclude=[]}Ext.apply(c,b)},statics:{setDefault:function(b,a){this.prototype[b]=a},setDefaults:function(a){Ext.apply(this.prototype,a)}},exclude:[],fields:false,fieldDefaults:{},datefieldDefaults:{},fileuploadfieldDefaults:{emptyText:"Select an file"},textfieldDefaults:{},numberfieldDefaults:{},checkboxfieldDefaults:{uncheckedValue:false},storeDefaultClass:"Ext.data.Store",storeDefaults:{autoLoad:true},oneStorePerModel:true,transformFieldConfig:function(b,a){return b},onSave:function(){var c=this,b=c.getForm(),a=c.getPanel().scaffold;b.submit({waitMsg:b.hasUpload()?"Uploading files...":"Saving data..",success:function(d,e){Ext.MessageBox.alert("Success",e.result.msg||"Successfully saved data.");var f=Ext.create(a.target.getName(),e.result.data);d.loadRecord(f);if(a.onSaved){a.onSaved.call(c,c,true,e)}},failure:function(d,e){if(e.result.msg||!e.result.errors){Ext.MessageBox.alert("Failed",e.result.msg||"Could not save data, unknown error.")}if(a.onSaved){a.onSaved.call(c,c,false,e)}}})},onSaved:Ext.emptyFn,onReset:function(){this.getForm().reset()},buttons:["reset","save"],saveButtonConfig:{iconCls:"icon-save",text:"Save",formBind:true},resetButtonConfig:{iconCls:"icon-reset",text:"Reset"},buildApiConfig:function(a,c){if(Bancha.getModel){return Ext.form.Panel.buildBanchaApiConfig(a,c)}else{if(c){return c}}var b=a.getProxy(),d=b&&b.api&&b.api.read?b.api.read:(b&&b.directFn?b.directFn:undefined);return d?{load:d}:undefined},loadRecord:false,beforeBuild:function(c,b,a){},afterBuild:function(d,c,b,a){}});Ext.define("Bancha.scaffold.grid.Config",{uses:["Ext.window.MessageBox"],constructor:function(b){b=b||{};var c=b.triggeredFrom||"Unknown Origin",a;if(Ext.isString(b)||Bancha.scaffold.Util.isModel(b)){b={target:b}}a=b.target;a=Ext.isString(a)?a:Ext.ClassManager.getName(a);Ext.syncRequire(a);b.target=Bancha.scaffold.Util.getModel(a);if(!Ext.isObject(b.formConfig)||!b.formConfig.$className){b.formConfig=b.formConfig||this.formConfig||{};b.formConfig.triggeredFrom=b.triggeredFrom;b.formConfig=Ext.apply(b.formConfig,{target:b.target});b.formConfig=Ext.create("Bancha.scaffold.form.Config",b.formConfig)}Ext.apply(this,b)},statics:{setDefault:function(b,a){this.prototype[b]=a},setDefaults:function(a){Ext.apply(this.prototype,a)}},exclude:[],fields:false,columnDefaults:{flex:1},gridcolumnDefaults:{},numbercolumnDefaults:{},booleancolumnDefaults:{},datecolumnDefaults:{},formConfig:{},storeDefaultClass:"Ext.data.Store",storeDefaults:{autoLoad:true},oneStorePerModel:true,transformColumnConfig:function(a,b){return a},onCreate:function(){var e=this.getCellEditing(),c=e.grid,a=this.getStore(),b=a.getProxy().getModel(),f,d=false;e.cancelEdit();f=Ext.create(Ext.ClassManager.getName(b),{});a.insert(0,f);Ext.each(c.columns,function(h,g){if(h.hidden!==true){d=g;return false}});if(d){e.startEditByPosition({row:0,column:d})}},onSave:function(){var c=true,d="",b,a=this.getStore();a.each(function(e){if(!e.isValid()){c=false;b=e.get("name")||e.get("title")||(e.phantom?"New entry":e.getId());d+="<br><br><b>"+b+":</b>";e.validate().each(function(f){d+="<br>&nbsp;&nbsp;&nbsp;"+f.field+" "+f.message})}});if(!c){Ext.MessageBox.show({title:"Invalid Data",msg:'<div style="text-align:left; padding-left:50px;">There are errors in your data:'+d+"</div>",icon:Ext.MessageBox.ERROR,buttons:Ext.Msg.OK})}else{a.sync()}},onReset:function(){var a=this.getStore();a.each(function(b){if(b&&b.modified){b.reject()}if(b&&b.phantom){a.remove(b)}});a.each(function(b){if(b&&b.modified){b.reject()}if(b&&b.phantom){a.remove(b)}})},onDelete:function(e,g,d){var b=e.getStore(),f=b.getAt(g),c=Ext.getClassName(f),a=Bancha.scaffold.Util.humanizeClassName(c);b.remove(f);b.sync({success:function(h,i){Ext.MessageBox.show({title:a+" record deleted",msg:a+" record was successfully deleted.",icon:Ext.MessageBox.INFO,buttons:Ext.Msg.OK})},failure:function(h,i){b.add(f);Ext.MessageBox.show({title:a+" record could not be deleted",msg:i.getError()||(a+" record could not be deleted."),icon:Ext.MessageBox.ERROR,buttons:Ext.Msg.OK})}})},editable:true,deletable:true,buttons:["->","create","reset","save"],createButtonConfig:{iconCls:"icon-add",text:"Create"},saveButtonConfig:{iconCls:"icon-save",text:"Save"},resetButtonConfig:{iconCls:"icon-reset",text:"Reset"},destroyButtonConfig:{xtype:"actioncolumn",width:30,items:[{iconCls:"icon-destroy",tooltip:"Delete",handler:Ext.emptyFn}]},beforeBuild:function(c,b,a){},afterBuild:function(d,c,b,a){}});Ext.define("Bancha.scaffold.Util",{singleton:true,toFirstUpper:function(a){if(typeof a!=="string"){return a}if(a.length===1){return a.toUpperCase()}return a.substr(0,1).toUpperCase()+a.substr(1)},humanize:function(a){a=a.replace(/_id/g,"");a=a.replace(/_/g," ");a=a.replace(/([a-z])([A-Z])/g,function(c,d,b){return d+" "+b.toLowerCase()});return this.toFirstUpper(a)},humanizeClassName:function(a){if(a.indexOf(".")){a=a.substr(a.lastIndexOf(".")+1)}return this.humanize(a)},toTitle:function(a){return a.replace(/ ([a-z])/g,function(b,c){return" "+c.toUpperCase()})},replaceButtonPlaceHolders:function(d,b,e){if(typeof d==="undefined"||d.length===0){return d}for(var c=0,a=d.length;c<a;c++){switch(d[c]){case"create":d[c]=Ext.apply(b.createButtonConfig,{scope:e,handler:b.onCreate});break;case"reset":d[c]=Ext.apply(b.resetButtonConfig,{scope:e,handler:b.onReset});break;case"save":d[c]=Ext.apply(b.saveButtonConfig,{scope:e,handler:b.onSave});break;default:if(d[c].scope==="scaffold-scope-me"){d[c].scope=e}}}return d},isModel:function(d){var b=Ext.isString(d)?d:Ext.ClassManager.getName(d),a=false;if(!b){return false}if(Ext.versions.extjs.major===4){return !!Ext.ModelManager.getModel(b)}var c=Ext.Error.handle;Ext.Error.handle=Ext.emptyFn;try{a=Ext.data.schema.Schema.lookupEntity(b)}catch(f){}Ext.Error.handle=c;return a},getModel:function(c){var b=Ext.isString(c)?c:Ext.ClassManager.getName(c),a;if(!b){Ext.Error.raise('No model given to Bancha.scaffold.Util.getModel("'+b+'").')}if(Ext.versions.extjs.major===4){a=Ext.ModelManager.getModel(b);if(!a){Ext.Error.raise('No such model "'+b+'" found.')}return a}return Ext.data.schema.Schema.lookupEntity(b)},getStore:(function(c,b){var a={};return function(g,f){var d=Ext.ClassManager.getName(g),e;f=f||{};if(f.oneStorePerModel&&a[d]){return a[d]}e=Ext.create(f.storeDefaultClass||"Ext.data.Store",Ext.apply({model:d},Ext.clone(f.storeDefaults||{})));if(f.oneStorePerModel){a[d]=e}return e}}()),getDisplayFieldName:function(a){if(a.getDisplayField&&a.getDisplayField()){return a.getDisplayField()}var b;if(Ext.versions.extjs.shortVersion<410){b=Ext.Array.pluck(a.prototype.fields.items,"name")}else{b=Ext.Array.pluck(a.getFields(),"name")}if(Ext.Array.indexOf(b,"name")!==-1){return"name"}if(Ext.Array.indexOf(b,"title")!==-1){return"title"}if(Ext.Array.indexOf(b,"code")!==-1){return"code"}return a.idProperty||b[0]},fieldNameToModelAssociationName:function(b,a){if(!Ext.isString(b)){return}var d=b.split("_");if(d.length<2||d[d.length-1]!=="id"){return}d.pop();var c=d.shift();Ext.each(d,function(e){c+=e.substr(0,1).toUpperCase()+e.substr(1)});return a==="belongsTo"?c:c+"s"},getBelongsToAssociation:function(e,b){var a,d,c;if(Ext.versions.extjs&&Ext.versions.extjs.major===5){d=b.associations;for(c in d){if(d.hasOwnProperty(c)&&d[c].foreignKey===e.name){return d[c]}}return false}a=this.fieldNameToModelAssociationName(e.name,"belongsTo");d=Ext.isFunction(b.getAssociations)?b.getAssociations():(b.prototype?b.prototype.associations:false);if(!a||!d){return false}return d.get(a)},getBelongsToModel:function(c,b){if(c.reference){return c.reference.cls}var a=this.getBelongsToAssociation(c,b);if(!a){return a}if(Ext.versions.extjs&&Ext.versions.extjs.major===5){return Ext.ClassManager.get(a.model)}return a.associatedModel}});Ext.define("Bancha.scaffold.form.override.Panel",{requires:["Ext.form.Panel","Bancha.scaffold.form.Config","Bancha.scaffold.data.Validators","Bancha.scaffold.form.field.override.VTypes","Bancha.scaffold.Util"]},function(){Ext.apply(Ext.form.Panel,{scaffold:false});Ext.override(Ext.form.Panel,{initComponent:function(){var b,a;if(this.scaffold){b=Ext.isString(this.scaffold)||Bancha.scaffold.Util.isModel(this.scaffold);if(b||(Ext.isObject(this.scaffold)&&!this.scaffold.$className)){this.scaffold.triggeredFrom="Ext.form.Panel";this.scaffold=Ext.create("Bancha.scaffold.form.Config",this.scaffold)}a=Ext.form.Panel.buildConfig(this.scaffold,this.initialConfig);Ext.apply(this,a);Ext.apply(this.initialConfig,a)}this.callOverridden()},statics:{fieldToFieldConfigs:{auto:{xtype:"textfield"},string:{xtype:"textfield"},"int":{xtype:"numberfield",allowDecimals:false},"float":{xtype:"numberfield"},"boolean":{xtype:"checkboxfield"},bool:{xtype:"checkboxfield"},date:{xtype:"datefield"}},internalTransformFieldConfig:function(b,a){if(b.name==="id"){b.xtype="hiddenfield"}return b},addValidationRuleConfigs:(function(){var c=/^[a-zA-Z_]+$/.toString(),d=/^[a-zA-Z0-9_]+$/.toString(),b=/^(\w+)([\-+.][\w]+)*@(\w[\-\w]*\.){1,5}([A-Za-z]){2,6}$/.toString(),a=/(((^https?)|(^ftp)):\/\/([\-\w]+\.)+\w{2,3}(\/[%\-\w]+(\.\w{2,})?)*(([\w\-\.\?\\\/+@&#;`~=%!]*)(\.\w{2,})?)*\/?)/i.toString();return function(i,h,g){var f=i.name,e;Ext.Array.forEach(h,function(j){if(j.field&&j.field!==f){return}switch(j.type){case"presence":i.allowBlank=false;break;case"length":if(i.xtype==="textfield"){if(Ext.isDefined(j.min)){i.minLength=j.min}if(Ext.isDefined(j.max)){i.maxLength=j.max}if(j.getMin&&Ext.isDefined(j.getMin())){i.minLength=j.getMin()}if(j.getMax&&Ext.isDefined(j.getMax())){i.maxLength=j.getMax()}}break;case"format":switch((j.matcher||j.getMatcher()).toString()){case c:i.vtype="alpha";break;case d:i.vtype="alphanum";break;case b:i.vtype="email";break;case a:i.vtype="url";break;default:break}break;case"range":if(i.xtype==="numberfield"){if(Ext.isDefined(j.min)){i.minValue=j.min}if(Ext.isDefined(j.max)){i.maxValue=j.max}if(Ext.isDefined(j.precision)){i.decimalPrecision=j.precision}if(j.getMin&&Ext.isDefined(j.getMin())){i.minValue=j.getMin()}if(j.getMax&&Ext.isDefined(j.getMax())){i.maxValue=j.getMax()}if(Ext.isDefined(j._precision)||Ext.isDefined((j.config||{}).precision)){i.decimalPrecision=j._precision||(j.config||{}).precision}}break;case"file":i.xtype="fileuploadfield";Ext.apply(i,g.fileuploadfieldDefaults);var k=j.getExtension?j.getExtension():j.extension;if(Ext.isString(k)){k=[k]}if(Ext.isArray(k)){i.vtype="fileExtension";i.validExtensions=k}break;default:break}});return i}}()),addValidatorRuleConfigs:function(d,a,b){var c=a[d.name];if(!c){return d}if(!Ext.isArray(c)){c=[c]}return this.addValidationRuleConfigs(d,c,b)},buildDefaultFieldFromModelType:function(b,d){d=d||{};var c=Ext.clone(this.fieldToFieldConfigs[b]),e=Ext.clone(d.fieldDefaults||this.fieldDefaults),a=Ext.clone(d[c.xtype+"Defaults"]||this[c.xtype+"Defaults"]);return Ext.apply(e,c,a)},buildFieldConfig:function(a,b,c,h){var f=Ext.versions.extjs.major===5?a.type:a.type.type,e=b.target,g=this.buildDefaultFieldFromModelType(f,b),i=Bancha.scaffold.Util,d,j;g.name=a.name;if(!h){g.fieldLabel=i.humanize(a.name)}if(f==="date"&&!h&&a.dateFormat){if(!g.format){g.format=a.dateFormat}else{d=(((Ext.form.field||{}).Date||{}).prototype||{}).altFormats||"m/d/Y|n/j/Y|n/j/y|m/j/y|n/d/y|m/j/Y|n/d/Y|m-d-y|m-d-Y|m/d|m-d|md|mdy|mdY|d|Y-m-d|n-j|n/j";g.altFormats=(g.altFormats||d)+"|"+a.dateFormat;g.submitFormat=a.dateFormat}}if(Ext.isDefined(c)&&c.length){g=this.addValidationRuleConfigs(g,c,b)}if(Ext.isDefined(c)&&Ext.Object.getSize(c)>0){g=this.addValidatorRuleConfigs(g,c,b)}if(!g){return}j=i.getBelongsToModel(a,e);if(j){Ext.apply(g,{xtype:"combobox",store:i.getStore(j,b),displayField:i.getDisplayFieldName(j),valueField:j.prototype.idProperty||"id",queryMode:"local"})}g=this.internalTransformFieldConfig(g,f);if(typeof b.transformFieldConfig==="function"){g=b.transformFieldConfig(g,f)}if(h&&g.xtype==="fileuploadfield"){g=undefined}return g},buildBanchaApiConfig:function(b,c){c=c||{};var a=Ext.ClassManager.getName(b),e=a.substr(Bancha.modelNamespace.length+1),d=Bancha.getStub(e);return{load:c.read||d.read,submit:c.submit||d.submit}},buildButtonScope:(function(){var a={getPanel:function(){return this.panel||Ext.ComponentManager.get(this.id)},getForm:function(){return this.form||this.getPanel().getForm()}};return function(b){return Ext.apply({id:b},a)}}()),buildConfig:function(b,l){l=l||{};var f=[],e=Bancha.scaffold.Util.getModel(b.target),g=this,j,c,k,d,i,a,h;j=b.beforeBuild(e,b,l)||{};c=typeof e.prototype.fields.keys==="function"?false:e.prototype.fields.keys;k=b.fields||c||Ext.Object.getKeys(e.fieldsMap);d=e.prototype.validations||e.validators;i=Ext.versions.extjs.major===5;Ext.each(k,function(n){if(Ext.Array.indexOf(b.exclude,n)===-1){var m=i?e.getField(n):e.prototype.fields.getByKey(n);f.push(g.buildFieldConfig(m,b,d))}});Ext.each(f,function(m){if(m.xtype==="fileuploadfield"){j.isUpload=true;j.fileUpload=true;return false}return true});a=l.id||Ext.id(null,"formpanel-");j.id=a;if(!b.hasOwnProperty("buttons")){b.buttons=Ext.clone(b.buttons||[])}b.buttons=Bancha.scaffold.Util.replaceButtonPlaceHolders(b.buttons,b,this.buildButtonScope(a));Ext.apply(j,l,{id:a,api:b.buildApiConfig(e,l.api),paramOrder:["data"],items:f,buttons:b.buttons});j.scaffold=b;if(Ext.isDefined(b.loadRecord)&&b.loadRecord!==false){h=function(n,m){n.load({params:{data:{data:{id:b.loadRecord}}}})};j.listeners=j.listeners||{};if(j.listeners.afterrender){j.listeners.afterrender=Ext.Function.createSequence(j.listeners.afterrender,h)}else{j.listeners.afterrender=h}}return b.afterBuild(j,e,b,l)||j}}});if(parseInt(Ext.versions.extjs.shortVersion,10)<410){Ext.apply(Ext.form.Panel,Ext.form.Panel.prototype.statics)}});Ext.define("Bancha.scaffold.grid.override.Panel",{requires:["Ext.grid.Panel","Bancha.scaffold.form.Config","Bancha.scaffold.grid.Config","Bancha.scaffold.data.Validators","Bancha.scaffold.form.field.override.VTypes","Bancha.scaffold.Util"]},function(){Ext.apply(Ext.grid.Panel,{scaffold:false});Ext.override(Ext.grid.Panel,{initComponent:function(){var b,a;if(this.scaffold){b=Ext.isString(this.scaffold)||Bancha.scaffold.Util.isModel(this.scaffold);if(b||(Ext.isObject(this.scaffold)&&!this.scaffold.$className)){this.scaffold.triggeredFrom="Ext.grid.Panel";this.scaffold=Ext.create("Bancha.scaffold.grid.Config",this.scaffold)}a=Ext.grid.Panel.buildConfig(this.scaffold,this.initialConfig);Ext.apply(this,a);Ext.apply(this.initialConfig,a)}this.callOverridden()},statics:{fieldToColumnConfigs:{auto:{xtype:"gridcolumn"},string:{xtype:"gridcolumn"},"int":{xtype:"numbercolumn",format:"0"},"float":{xtype:"numbercolumn"},"boolean":{xtype:"booleancolumn"},bool:{xtype:"booleancolumn"},date:{xtype:"datecolumn"}},internalTransformColumnConfig:function(a,b){if(a.dataIndex==="id"){a.hidden=true;a.editor=undefined}return a},buildDefaultColumnFromModelType:function(c,d){d=d||{};var b=this.fieldToColumnConfigs[c],a=Ext.clone(d.columnDefaults||this.columnDefaults),e=d[b.xtype+"Defaults"]||this[b.xtype+"Defaults"];return Ext.apply(a,b,e)},buildColumnConfig:function(g,b,c,a){var f=Ext.versions.extjs.major===5?g.type:g.type.type,d=this.buildDefaultColumnFromModelType(f,b),e=b.target,j,h,i;if(g.name){d.text=Bancha.scaffold.Util.humanize(g.name);d.dataIndex=g.name}j=Bancha.scaffold.Util.getBelongsToModel(g,e);if(j){h=Bancha.scaffold.Util.getStore(j,b);i=Bancha.scaffold.Util.getDisplayFieldName(j);d.renderer=function(l){var k=h.getById(l);return k?k.get(i):(Bancha.t?Bancha.t("Unknown"):"Unknown")};d.updater=function(k,o,m,l){var n=d.renderer(o);Ext.fly(k).child("div").setHtml(n)};a.render=Ext.Function.createSequence(a.render||Ext.emptyFn,function(k){if(h.getCount()===0){h.on("load",function(m,l,o,n){if(o){k.getView().refresh()}})}})}if(b.editable){Ext.syncRequire(["Ext.form.Panel","Bancha.scaffold.form.override.Panel"]);d.editor=Ext.form.Panel.buildFieldConfig(g,b.formConfig,c,true);if(d.editor){d.editor=Ext.form.Panel.internalTransformFieldConfig(d.editor,f);if(typeof b.formConfig.transformFieldConfig==="function"){d.editor=b.formConfig.transformFieldConfig(d.editor,f)}}}d=Ext.grid.Panel.internalTransformColumnConfig(d,f);if(typeof b.transformColumnConfig==="function"){d=b.transformColumnConfig(d,f)}return d},buildColumns:function(b,a){var e=[],g=b.target,h=this,c,j,d,i,f;if(!Ext.isArray(b.exclude)){b.exclude=[]}c=typeof g.prototype.fields.keys==="function"?false:g.prototype.fields.keys;j=b.fields||c||Ext.Object.getKeys(g.fieldsMap);d=g.prototype.validations||g.validators;i=Ext.versions.extjs.major===5;Ext.each(j,function(l){if(Ext.Array.indexOf(b.exclude,l)===-1){var k=i?g.getField(l):g.prototype.fields.getByKey(l);e.push(h.buildColumnConfig(k,b,d,a))}});if(b.deletable){f=Ext.clone(b.destroyButtonConfig);if(f.items[0].handler===Ext.emptyFn){f.items[0].handler=b.onDelete}e.push(f)}return e},buildConfig:function(d,a){a=a||{};var c=Bancha.scaffold.Util.getModel(d.target),h,g,b,f,e;h=d.beforeBuild(c,d,a)||{};b=Bancha.scaffold.Util.getStore(c,d);e={};Ext.apply(h,{store:b,columns:this.buildColumns(d,e),listeners:e});if(d.editable){g=Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:2});Ext.apply(h,{selType:"cellmodel",plugins:[g]})}if(d.buttons&&d.buttons.length){f={getCellEditing:function(){return g},getStore:function(){return b}};if(!d.hasOwnProperty("buttons")){d.buttons=Ext.clone(d.buttons||[])}d.buttons=Bancha.scaffold.Util.replaceButtonPlaceHolders(d.buttons,d,f);h.dockedItems=[{xtype:"toolbar",dock:"bottom",ui:"footer",items:d.buttons}]}if(Ext.isObject(a)){h=Ext.apply(h,a)}h.scaffold=d;return d.afterBuild(h,c,d,a)||h}}});if(parseInt(Ext.versions.extjs.shortVersion,10)<410){Ext.apply(Ext.grid.Panel,Ext.grid.Panel.prototype.statics)}});Ext.define("Bancha.scaffold.grid.ManagementPanel",{extend:"Ext.tab.Panel",alias:"widget.managementpanel",models:[],panelDefaults:{},scaffoldDefaults:{},initComponent:function(){this.models=this.models||[];this.items=this.items||[];var a=this.items,b=this;Ext.each(this.models,function(e){var c=Ext.isString(e)?e:e.getName();e=Bancha.scaffold.Util.getModel(c);if(!e&&Bancha.modelNamespace){e=Bancha.scaffold.Util.getModel(Bancha.modelNamespace+"."+c)}var d={xtype:"gridpanel",title:Bancha.scaffold.Util.toTitle(Bancha.scaffold.Util.humanizeClassName(c)),scaffold:{target:c,buttons:false,deletable:true}};var f=e.getProxy();if(f.api){var g=["->"];if(f.api.create){g.push("create")}if(f.api.create||f.api.update){g.push("reset");g.push("save")}if(g.length>1){d.scaffold.buttons=g}else{d.scaffold.editable=false}if(!f.api.destroy){d.scaffold.deletable=false}}else{if(f.writer){delete d.scaffold.buttons}}d=Ext.apply(d,b.panelDefaults);d.scaffold=Ext.apply(d.scaffold,b.scaffoldDefaults);a.push(d)});this.callParent()}});